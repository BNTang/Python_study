# -*- coding: utf-8 -*-

# @Time    : 2025-5-28
# @Author  : ç¨‹åºå‘˜NEO
# @FileName: example.py
# @Software: VSCode
# @Email   : it666@linux.do
# @Github  : https://github.com/BNTang
# @Description: 19-Python-å‡½æ•°-é—­åŒ…-æ³¨æ„äº‹é¡¹

print("=" * 60)
print("ğŸ”¥ Pythoné—­åŒ…æ³¨æ„äº‹é¡¹ - é‡è¦çŸ¥è¯†ç‚¹")
print("=" * 60)

# ============================================================================
# ğŸ“Œ æ³¨æ„äº‹é¡¹1: ä¿®æ”¹å¤–éƒ¨å˜é‡å¿…é¡»ä½¿ç”¨ nonlocal å…³é”®å­—
# ============================================================================
print("\nã€æ³¨æ„äº‹é¡¹1ã€‘ä¿®æ”¹å¤–éƒ¨å˜é‡å¿…é¡»ä½¿ç”¨ nonlocal")
print("-" * 40)

def test():
    number = 10
    
    def test2():
        # âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥èµ‹å€¼ä¼šåˆ›å»ºæ–°çš„å±€éƒ¨å˜é‡
        # number = 666  # è¿™æ ·å†™ä¼šåˆ›å»ºæ–°å˜é‡ï¼Œä¸ä¼šä¿®æ”¹å¤–éƒ¨å˜é‡
        
        # âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ nonlocal å£°æ˜
        nonlocal number  # å£°æ˜è¦ä¿®æ”¹å¤–éƒ¨çš„ number å˜é‡
        print(f"ä¿®æ”¹å‰çš„number: {number}")
        number = 666     # ç°åœ¨å¯ä»¥ä¿®æ”¹å¤–éƒ¨å˜é‡äº†
        print(f"ä¿®æ”¹åçš„number: {number}")
    
    return test2

print("ğŸ” æµ‹è¯• nonlocal çš„ä½¿ç”¨:")
result = test()
result()

# ============================================================================
# ğŸ“Œ æ³¨æ„äº‹é¡¹2: é—­åŒ…ä¸­å˜é‡çš„å»¶è¿Ÿç»‘å®šé—®é¢˜
# ============================================================================
print("\nã€æ³¨æ„äº‹é¡¹2ã€‘é—­åŒ…ä¸­å˜é‡çš„å»¶è¿Ÿç»‘å®šé—®é¢˜")
print("-" * 40)

print("âŒ é”™è¯¯ç¤ºä¾‹ - æ‰€æœ‰å‡½æ•°éƒ½å¼•ç”¨åŒä¸€ä¸ªå˜é‡:")

def test_wrong():
    """é”™è¯¯ç¤ºä¾‹ï¼šæ‰€æœ‰é—­åŒ…å‡½æ•°éƒ½ä¼šæ‰“å°ç›¸åŒçš„å€¼"""
    funcs = []
    
    for i in range(1, 4):  # i = 1, 2, 3
        def inner():
            print(f"æ‰“å° i çš„å€¼: {i}")  # æ‰€æœ‰å‡½æ•°éƒ½å¼•ç”¨åŒä¸€ä¸ª i
        funcs.append(inner)
    
    return funcs

# æµ‹è¯•é”™è¯¯ç¤ºä¾‹
wrong_funcs = test_wrong()
print("æ‰§è¡Œç»“æœï¼ˆéƒ½æ˜¯3ï¼Œå› ä¸ºå¾ªç¯ç»“æŸå i=3ï¼‰:")
for func in wrong_funcs:
    func()

print("\n" + "="*50)
print("âœ… æ­£ç¡®ç¤ºä¾‹ - æ¯ä¸ªå‡½æ•°ä¿å­˜ä¸åŒçš„å€¼:")

def test_correct():
    """æ­£ç¡®ç¤ºä¾‹ï¼šé€šè¿‡å‚æ•°ä¼ é€’ä¿å­˜å½“å‰å€¼"""
    funcs = []
    
    for i in range(1, 4):
        def outer(num):  # é€šè¿‡å‚æ•°æ¥æ”¶å½“å‰çš„ i å€¼
            def inner():
                print(f"æ‰“å°ä¿å­˜çš„å€¼: {num}")  # ä½¿ç”¨å‚æ•°ä¸­ä¿å­˜çš„å€¼
            return inner
        
        funcs.append(outer(i))  # ç«‹å³è°ƒç”¨ outerï¼Œä¼ å…¥å½“å‰çš„ i å€¼
    
    return funcs

# æµ‹è¯•æ­£ç¡®ç¤ºä¾‹
correct_funcs = test_correct()
print("æ‰§è¡Œç»“æœï¼ˆåˆ†åˆ«æ˜¯1ã€2ã€3ï¼‰:")
for func in correct_funcs:
    func()

# ============================================================================
# ğŸ“š æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“
# ============================================================================
print("\n" + "="*60)
print("ğŸ“š æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“")
print("="*60)

print("""
ğŸ¯ é—­åŒ…çš„ä¸¤å¤§æ³¨æ„äº‹é¡¹ï¼š

1ï¸âƒ£ ä¿®æ”¹å¤–éƒ¨å˜é‡ï¼š
   âŒ ç›´æ¥èµ‹å€¼ â†’ åˆ›å»ºæ–°çš„å±€éƒ¨å˜é‡
   âœ… ä½¿ç”¨ nonlocal â†’ ä¿®æ”¹å¤–éƒ¨å˜é‡

2ï¸âƒ£ å˜é‡å»¶è¿Ÿç»‘å®šï¼š
   âŒ å¾ªç¯ä¸­ç›´æ¥å¼•ç”¨å˜é‡ â†’ æ‰€æœ‰é—­åŒ…å…±äº«æœ€ç»ˆå€¼
   âœ… é€šè¿‡å‚æ•°ä¼ é€’ â†’ æ¯ä¸ªé—­åŒ…ä¿å­˜ç‹¬ç«‹å€¼

ğŸ’¡ è®°å¿†è¦ç‚¹ï¼š
   - å‡½æ•°å®šä¹‰æ—¶ä¸ç¡®å®šå˜é‡å€¼ï¼Œåªæœ‰è°ƒç”¨æ—¶æ‰ç¡®å®š
   - nonlocal å£°æ˜"æˆ‘è¦ä¿®æ”¹å¤–éƒ¨å˜é‡"
   - å‚æ•°ä¼ é€’å¯ä»¥"å†»ç»“"å½“å‰å˜é‡å€¼
""")

print("="*60)
print("ğŸ‰ å­¦ä¹ å®Œæˆï¼é‡ç‚¹å·²æ ‡æ³¨ï¼Œå»ºè®®å¤šç»ƒä¹ åŠ æ·±ç†è§£")
print("="*60)
